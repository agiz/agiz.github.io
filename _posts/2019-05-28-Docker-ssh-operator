---
layout: post
title: Docker SSH operator
---

So this is a brief introduction on how to start docker's SSHOperator
without password but with authorized keys.

Add new connection. You have to provide:
* Conn id (this is the ID you will reference in the dag file)
* Conn type (SSH obviously)
* Host (IP or hostname)
* Username (username of the user you will provide the key for)
* Password (leave blank)
* Port (leave blank, defaults to 22)
* Extra (here we will tell airflow to use provided private key):
`{"key_file": "/usr/local/airflow/dags/id_rsa", "no_host_key_check": true}`

![_config.yml]({{ site.baseurl }}/images/Screenshot\ 2019-05-28\ at\ 20.32.58.png)
*Figure 1: Admin -> Connections -> Create. Add new ssh connection as shown on the screen*

After this step is set and done, we will create dag file.

```
from datetime import timedelta, datetime
import airflow
from airflow import DAG
from airflow.contrib.operators.ssh_operator import SSHOperator

default_args = {
    'owner': 'airflow',
    'depends_on_past': False,
    'email': ['airflow@example.com'],
    'email_on_failure': False,
    'email_on_retry': False,
    'start_date': datetime.now() - timedelta(minutes=20),
    'retries': 1,
    'retry_delay': timedelta(minutes=5),
}

dag = DAG(
    dag_id='ssh_test',
    default_args=default_args,
    schedule_interval='0,10,20,30,40,50 * * * *',
    dagrun_timeout=timedelta(seconds=120),
    concurrency=1,    # prevent concurrent DAGs to execute same tasks
    max_active_runs=1 # prevent concurrent DAGs to execute same tasks
)
# Step 1 - Dump data from postgres databases

t1_bash = """
echo 'Hello World'
"""

t1 = SSHOperator(
    ssh_conn_id='ssh_instance_1',
    task_id='test_ssh_operator',
    command=t1_bash,
    dag=dag)

```
